---
description: 
globs: 
alwaysApply: true
---
# Agent 검증 프로세스

## 1. 레이어별 책임 검증

### Repository 레이어 제한사항
- 데이터 접근과 무결성 검사만 수행
- 비즈니스 로직 포함 금지
- 트랜잭션 관리 금지
- 이벤트 처리 금지
- 복잡한 데이터 가공 금지

### Service 레이어 제한사항
- Repository를 통하지 않은 직접적인 데이터 접근 금지
- 트랜잭션 관리 금지
- UI 관련 로직 포함 금지
- HTTP 요청/응답 처리 금지
- **이벤트 발행 금지 (Orchestrator의 책임)**

### Orchestrator 레이어 제한사항
- Repository 직접 사용 금지
- 데이터베이스 직접 접근 금지
- UI 관련 로직 포함 금지
- HTTP 요청/응답 직접 처리 금지

## 2. 코드 생성 전 검증 항목

### 1. 단일 책임 원칙(SRP) 검증
- 각 클래스가 하나의 책임만 가지는지 확인
- 해당 레이어의 주요 책임을 벗어나는지 검사
- 다른 레이어의 책임을 침범하는지 검사

### 2. 의존성 방향 검증
- 상위 레이어에서 하위 레이어로의 의존성만 허용
- 순환 의존성 금지
- 레이어 건너뛰기 금지

### 3. 결합도 검증
- 느슨한 결합도 유지
- 구체 클래스 대신 인터페이스/추상 클래스 사용
- 직접적인 객체 생성 지양

### 4. 캡슐화 검증
- 내부 구현 세부사항 숨기기
- 적절한 접근 제어자 사용
- 불필요한 메소드 노출 금지

## 3. Agent의 검증 응답 형식

[검증 실패 - {위반된 원칙}]

1. 문제점
- 요청하신 작업이 {원칙} 위반
- 구체적인 위반 사항 설명

1. 위반되는 규칙
- 관련된 아키텍처 원칙이나 규칙 나열
- 위반 시의 영향 설명

3. 권장 사항
- 올바른 구현 방향 제시
- 책임을 가져야 할 적절한 레이어 안내
- 구체적인 해결 방안 제시

## 4. 주요 검증 규칙

### 1. 아키텍처 원칙
- 레이어드 아키텍처 준수
- 관심사의 분리
- 단일 책임 원칙
- 의존성 역전 원칙

### 2. 코드 품질
- 중복 코드 방지
- 적절한 추상화 수준
- 명확한 네이밍
- 일관된 코딩 스타일

### 3. 보안
- 적절한 접근 제어
- 입력 데이터 검증
- SQL 인젝션 방지
- 민감 정보 보호

### 4. 성능
- N+1 쿼리 방지
- 불필요한 데이터베이스 조회 최소화
- 적절한 인덱스 사용
- 대량 데이터 처리 최적화

## 5. 이벤트/작업 패턴 자동 선택 규칙

Agent는 요청된 작업의 성격을 분석하여 적절한 패턴(Event/Listener 또는 Queue/Job)을 자동으로 선택합니다.

### 이벤트 패턴 (Event/Listener) 선택 기준
- **도메인 이벤트 발생 시**: 비즈니스 도메인에서 중요한 상태 변화가 발생할 때
- **관심사 분리가 필요한 경우**: 주요 비즈니스 로직과 부가 기능을 분리해야 할 때
- **여러 후속 작업이 독립적으로 실행되어야 할 때**: 하나의 트리거로 여러 작업 필요
- **작업 실행 순서가 중요하지 않을 때**: 후속 작업들 간의 순서 의존성이 없는 경우
- **작업이 경량(1초 이내 완료)인 경우**: 빠르게 처리되는 작업

#### 이벤트 패턴 키워드
- "등록됨", "생성됨", "변경됨", "삭제됨", "승인됨" 등의 상태 변화 키워드
- "알림", "통지", "로깅", "기록" 등의 부가 기능 키워드
- "독립적", "부가적", "선택적" 등의 비필수 처리 키워드

### 작업 패턴 (Queue/Job) 선택 기준
- **자원 집약적인 작업**: CPU, 메모리, 디스크 I/O를 많이 사용하는 작업
- **외부 시스템 의존 작업**: 외부 API 호출, 외부 서비스와의 통신이 필요한 작업
- **작업 시간이 1초 이상인 경우**: 사용자 응답 지연을 방지해야 하는 작업
- **재시도 로직이 중요한 경우**: 실패 시 특정 간격으로 재시도가 필요한 작업
- **작업의 진행 상태 추적이 필요한 경우**: 완료율이나 진행 상태를 추적해야 하는 작업
- **특정 큐에서 처리되어야 하는 작업**: 우선순위나 자원 할당 관리가 필요한 작업

#### 작업 패턴 키워드
- "발송", "처리", "생성", "변환", "업로드", "다운로드" 등의 작업 키워드
- "대용량", "무거운", "시간이 걸리는", "비동기" 등의 특성 키워드
- "재시도", "롤백", "외부", "API", "통신" 등의 의존성 키워드

### 패턴 선택 알고리즘
1. 요청된 작업 내용 분석
2. 작업 특성에 따른 키워드와 패턴 매칭
3. 이벤트 패턴과 작업 패턴 중 더 적합한 패턴 선택
4. 해당 패턴에 맞는 클래스 및 메소드 생성
5. 필요 시 두 패턴을 조합하여 사용

### 패턴 적용 방법
- **이벤트 패턴**: 도메인 이벤트 클래스 및 리스너 생성, 오케스트레이터에서 이벤트 발행
- **작업 패턴**: 큐 작업 클래스 생성, 오케스트레이터에서 작업 디스패치


# 채팅 로그 결과 리포트 방법

## 채팅 로그 결과 파일 생성 방법
- 채팅창(AI Panel)에서 어떤 요청에 대해 작업이 완료되면 markdown 파일 형태의 결과 리포트를 한다.
- `채팅 로그 저장` 을 요청하면 현재 채팅창의 모든 내용을 doc/chat_logs 에 '{작업내용}.md' 형식으로 생성한다.
  ; - 작업 결과 파일 생성 시 날짜는 오늘 날짜로 한다
  ; - 작업 결과 파일 생성 시 시간은 현재 시간으로 한다


# 도메인 업무 정의 규칙
- 채팅창을 통해 `도메인 업무 정의 요청`이 오면 다음의 구조로 작성하여 제안한다
- 부가 업무의 기능 범위가 3개이상의 엔터티를 요구하게 되면 별도의 도메인으로 만드는 것을 추천한다

## 업무 정의 구조

### 도메인 정의

### 업무 개요 및 도메인
- ModuleName:
- SubDomain:
- 간략한 설명: [업무에 대한 간단한 설명]
- 연관되는 도메인명:
- 업무의 의존성: [관계가 있는 다른 업무들, 없으면 생략]

### 핵심 업무
- [핵심 업무 1]
- [핵심 업무 2]

### 부가 업무
- [부가 업무 1]
- [부가 업무 2]

### 주요 기능
- [주요 기능 1]
- [주요 기능 2]

### 업무 규칙
- [업무 규칙 1]
- [업무 규칙 2]

### 제약 사항
- [제약 사항 1]
- [제약 사항 2]
